#!/usr/bin/env ruby
repo="sickp/alpine-nginx"

nginx_version = ARGV.first || ''
md = nginx_version.match(/\A((\d+\.\d+)\.\d+)-r\d+\z/)
case md && md[2]
when "1.11"
  puts "Building mainline..."
when "1.10"
  puts "Building stable..."
else
  puts "Usage: build {major}.{minor}.{teeny}-r{revision}"
  exit 1
end

system("docker image build --tag #{repo}:#{nginx_version} --pull versions/#{nginx_version}") || abort
puts "Built #{repo}:#{nginx_version}"
