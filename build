#!/bin/bash
set -e
repo=sickp/alpine-nginx
latest=1.9.10
version=${1:-$latest}

docker build -t ${repo}:${version} --pull versions/${version}
docker build -t ${repo}:${version}-k8s --pull versions/${version}-k8s
echo "=> Built ${repo}:${version}"

if [[ $latest == $version ]]; then
  tags="1.9 mainline latest"
  for tag in ${tags}; do
    docker tag -f ${repo}:${version} ${repo}:${tag}
    docker tag -f ${repo}:${version}-k8s ${repo}:${tag}-k8s
    echo "=> Tagged ${repo}:${tag}"
  done
fi
